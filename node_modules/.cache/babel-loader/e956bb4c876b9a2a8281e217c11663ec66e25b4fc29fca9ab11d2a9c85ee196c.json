{"ast":null,"code":"import apiClient from \"./api-client\";\n\n// Endpoints OpenIddict\nconst endpoints = {\n  login: \"/connect/token\",\n  profile: \"/api/app/user\"\n};\nexport const auth = {\n  // ✅ Login\n  login: async (username, password) => {\n    const params = new URLSearchParams();\n    params.append(\"grant_type\", process.env.REACT_APP_AUTH_GRANT_TYPE);\n    params.append(\"client_id\", process.env.REACT_APP_AUTH_CLIENT_ID);\n    params.append(\"client_secret\", process.env.REACT_APP_AUTH_CLIENT_SECRET);\n    params.append(\"username\", username);\n    params.append(\"password\", password);\n    params.append(\"scope\", process.env.REACT_APP_AUTH_SCOPE);\n    try {\n      const res = await apiClient.post(endpoints.login, params, {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n          Accept: \"text/plain\" // OpenIddict yêu cầu\n        }\n      });\n      if (res.data.access_token) {\n        localStorage.setItem(\"access_token\", res.data.access_token);\n        localStorage.setItem(\"refresh_token\", res.data.refresh_token || \"\");\n        localStorage.setItem(\"token_expires_at\", (Date.now() + res.data.expires_in * 1000).toString());\n      }\n      return res.data;\n    } catch (error) {\n      var _error$response;\n      console.error(\"❌ [AUTH LOGIN ERROR]\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n      throw error;\n    }\n  },\n  // ✅ Lấy profile\n  getProfile: async () => {\n    const token = localStorage.getItem(\"access_token\");\n    if (!token) throw new Error(\"No access token found\");\n    try {\n      const res = await apiClient.get(endpoints.profile, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      return res.data;\n    } catch (error) {\n      var _error$response2;\n      console.error(\"❌ [AUTH GET PROFILE ERROR]\", ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n      throw error;\n    }\n  },\n  // ✅ Logout\n  logout: () => {\n    localStorage.removeItem(\"access_token\");\n    localStorage.removeItem(\"refresh_token\");\n    localStorage.removeItem(\"token_expires_at\");\n  }\n};","map":{"version":3,"names":["apiClient","endpoints","login","profile","auth","username","password","params","URLSearchParams","append","process","env","REACT_APP_AUTH_GRANT_TYPE","REACT_APP_AUTH_CLIENT_ID","REACT_APP_AUTH_CLIENT_SECRET","REACT_APP_AUTH_SCOPE","res","post","headers","Accept","data","access_token","localStorage","setItem","refresh_token","Date","now","expires_in","toString","error","_error$response","console","response","message","getProfile","token","getItem","Error","get","Authorization","_error$response2","logout","removeItem"],"sources":["D:/Nam 5/CĐTH/RCP_Project/frontend_web/src/services/auth-api.jsx"],"sourcesContent":["import apiClient from \"./api-client\";\n\n// Endpoints OpenIddict\nconst endpoints = {\n  login: \"/connect/token\",\n  profile: \"/api/app/user\",\n};\n\nexport const auth = {\n  // ✅ Login\n  login: async (username, password) => {\n    const params = new URLSearchParams();\n    params.append(\"grant_type\", process.env.REACT_APP_AUTH_GRANT_TYPE);\n    params.append(\"client_id\", process.env.REACT_APP_AUTH_CLIENT_ID);\n    params.append(\"client_secret\", process.env.REACT_APP_AUTH_CLIENT_SECRET);\n    params.append(\"username\", username);\n    params.append(\"password\", password);\n    params.append(\"scope\", process.env.REACT_APP_AUTH_SCOPE);\n\n    try {\n      const res = await apiClient.post(endpoints.login, params, {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n          Accept: \"text/plain\", // OpenIddict yêu cầu\n        },\n      });\n\n      if (res.data.access_token) {\n        localStorage.setItem(\"access_token\", res.data.access_token);\n        localStorage.setItem(\"refresh_token\", res.data.refresh_token || \"\");\n        localStorage.setItem(\n          \"token_expires_at\",\n          (Date.now() + res.data.expires_in * 1000).toString()\n        );\n      }\n\n      return res.data;\n    } catch (error) {\n      console.error(\n        \"❌ [AUTH LOGIN ERROR]\",\n        error.response?.data || error.message\n      );\n      throw error;\n    }\n  },\n\n  // ✅ Lấy profile\n  getProfile: async () => {\n    const token = localStorage.getItem(\"access_token\");\n    if (!token) throw new Error(\"No access token found\");\n\n    try {\n      const res = await apiClient.get(endpoints.profile, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      return res.data;\n    } catch (error) {\n      console.error(\n        \"❌ [AUTH GET PROFILE ERROR]\",\n        error.response?.data || error.message\n      );\n      throw error;\n    }\n  },\n\n  // ✅ Logout\n  logout: () => {\n    localStorage.removeItem(\"access_token\");\n    localStorage.removeItem(\"refresh_token\");\n    localStorage.removeItem(\"token_expires_at\");\n  },\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}